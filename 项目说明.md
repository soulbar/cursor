# 订阅节点汇聚仓库 - 项目说明

## ✅ 已创建的文件

### 核心脚本
- **main.py** - 主执行脚本，整合所有功能
- **fetch_subscriptions.py** - 获取和解析订阅链接
- **test_nodes.py** - 节点测速（过滤延迟>500ms的节点）
- **generate_clash.py** - 生成Clash配置文件

### 配置文件
- **config.py** - 项目配置（订阅链接、延迟阈值、分流规则等）
- **requirements.txt** - Python依赖包列表

### 文档
- **README.md** - 项目说明文档
- **DEPLOY.md** - 部署说明文档
- **项目说明.md** - 本文件

### 自动化
- **.github/workflows/update.yml** - GitHub Actions工作流（每3小时自动更新）
- **.gitignore** - Git忽略文件配置

## 📋 功能特性

### 1. 订阅链接获取
- ✅ 支持5个订阅链接
- ✅ 自动解析SS、VMess、Trojan等协议
- ✅ 支持Base64编码的订阅内容
- ✅ 自动去重节点

### 2. 节点测速
- ✅ TCP连接测试延迟
- ✅ 自动过滤延迟>500ms的节点
- ✅ 显示测试进度和结果
- ✅ 支持异步和同步两种测速模式

### 3. 分流规则
已配置以下分流规则：
- ✅ YouTube
- ✅ ChatGPT (OpenAI/Claude)
- ✅ Netflix
- ✅ Cloudflare
- ✅ Google服务
- ✅ Telegram
- ✅ Twitter
- ✅ Facebook/Instagram
- ✅ GitHub
- ✅ Microsoft服务

### 4. Clash配置生成
- ✅ 按延迟排序节点
- ✅ 创建多个代理组（自动选择、手动选择、最快节点等）
- ✅ 完整的分流规则
- ✅ DNS配置
- ✅ 支持Clash-party格式

### 5. 自动更新
- ✅ 每3小时自动运行
- ✅ 自动提交更改
- ✅ 自动创建GitHub Release
- ✅ Release中提供YAML文件下载

## 🚀 快速开始

### 本地运行

1. **安装依赖**
```bash
pip install -r requirements.txt
```

2. **运行脚本**
```bash
python main.py
```

3. **查看生成的配置文件**
```bash
cat clash-config.yaml
```

### 部署到GitHub

1. **创建GitHub仓库**
   - 登录GitHub
   - 创建新仓库（Public或Private）
   - 不要初始化README

2. **推送代码**
```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git push -u origin main
```

3. **启用GitHub Actions**
   - 进入仓库Settings -> Actions -> General
   - 设置Workflow permissions为"Read and write"
   - 保存设置

4. **手动触发首次运行**
   - 进入Actions标签页
   - 点击"自动更新订阅配置"
   - 点击"Run workflow"

## 📝 配置说明

编辑 `config.py` 可以修改以下配置：

- **SUBSCRIPTION_URLS** - 订阅链接列表
- **MAX_LATENCY** - 最大延迟阈值（默认500ms）
- **RULES** - 分流规则配置
- **CLASH_CONFIG_TEMPLATE** - Clash配置模板

## 📥 下载配置文件

配置文件会在以下位置可用：

1. **GitHub Release** - 每次更新后自动创建
2. **仓库根目录** - `clash-config.yaml` 文件

在Release页面下载最新的 `clash-config.yaml` 文件，然后导入到Clash客户端即可使用。

## ⚙️ 自定义配置

### 添加新的订阅链接

编辑 `config.py`，在 `SUBSCRIPTION_URLS` 列表中添加新链接：

```python
SUBSCRIPTION_URLS = [
    # ... 现有链接 ...
    "https://your-new-subscription-url.com/sub"
]
```

### 修改延迟阈值

编辑 `config.py`：

```python
MAX_LATENCY = 300  # 改为300ms
```

### 添加新的分流规则

编辑 `config.py`，在 `RULES` 字典中添加：

```python
RULES = {
    # ... 现有规则 ...
    "新服务": [
        "DOMAIN-SUFFIX,example.com",
        "DOMAIN-SUFFIX,example.org"
    ]
}
```

## 🔍 故障排除

### 问题：没有获取到节点

**可能原因：**
- 订阅链接不可访问
- 链接格式不正确
- 需要特殊认证

**解决方法：**
- 检查链接是否可访问
- 查看脚本输出错误信息
- 尝试手动访问订阅链接

### 问题：节点测速失败

**可能原因：**
- 网络连接问题
- 防火墙阻止
- 节点服务器不可达

**解决方法：**
- 检查网络连接
- 调整超时时间（在config.py中）
- 查看详细错误信息

### 问题：GitHub Actions失败

**可能原因：**
- 权限不足
- 依赖安装失败
- 脚本执行错误

**解决方法：**
- 检查Actions权限设置
- 查看Actions日志
- 确保requirements.txt中的依赖可用

## 📞 技术支持

如有问题，请查看：
- README.md - 项目文档
- DEPLOY.md - 部署说明
- GitHub Issues - 提交问题

---

**最后更新：** 2024年

